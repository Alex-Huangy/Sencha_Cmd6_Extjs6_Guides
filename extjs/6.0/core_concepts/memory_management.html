<!DOCTYPE html><html><head> 
  <link href="../css/main.css" rel="stylesheet" type="text/css" /> 
  <script type="text/javascript" src="../MarkdownWebapp/MarkdownWebapp.nocache.js"></script> 
  <script type="text/javascript" src="../ace/ace.js"></script> 
  <link rel="icon" type="image/x-icon" href="../favicon.ico" /> 
  <script type="text/javascript">window["_GOOG_TRANS_EXT_VER"] = "1";</script> 
  <title>Ext JS 向导 | 内存管理</title> 
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" /> 
  <script async="" type="text/javascript" src="../../../../https@use.typekit.com/bqo8qzg.js"></script> 
  <script type="text/javascript">

    function showMenu(link_obj){
      var menu = document.getElementById("tpl-toc");

      link_obj.innerHTML = (link_obj.innerHTML == 'CLOSE MENU') ? 'MENU' : 'CLOSE MENU';

      if(menu.style.display == 'block'){
         menu.style.display = 'none';
      }else{
         menu.style.display = 'block';
      }
    }

  </script> 
 </head> 
 <body> 
  <div id="header"> 
   <a href="../../../../www.sencha.com/default.htm"><img class="sencha-logo" src="../images/logo.png" /></a> 
   <h1 id="current-product"><a href="#">Ext JS 向导 ▼</a></h1> 
   <div id="mobile_menu"> 
    <a id="mobile_menu_link" onclick="showMenu(this);" href="#">MENU</a> 
   </div> 
    
  </div> 
  <div id="content" itemscope="" itemtype="http://schema.org/Article"> 
   <div id="tpl-toc"> 
    <div id="tpl-toc-content"> 
     <a class="toggle-button" href="#">expand</a> 
     <ul> 
      <li class="file"><a href="../../../default.htm" data-full-load="true" title="Home">Sencha 向导</a></li> 
      <li class="file"><a href="../index.html" title="Guide Home">Sencha Ext JS 向导</a></li> 
      <li class="folder"><a href="#">快速入门</a> 
       <ul expand="false"> 
        <li class="file"><a href="../getting_started/getting_started.html" title="Get Started">安装 &amp; 快速入门</a></li> 
        <li class="file"><a href="../getting_started/extjs_faq.html" title="">Ext JS - 问答</a></li> 
        <li class="file"><a href="../getting_started/login_app.html" title="">创建一个简单的登录应用</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">Ext JS 6 API 文档</a> 
       <ul expand="false"> 
        <li class="file"><a href="../6.0.2-classic/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.2 Classic API 文档</a></li> 
        <li class="file"><a href="../6.0.2-modern/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.2 Modern API 文档</a></li> 
        <li class="file"><a href="../6.0.1-classic/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.1 Classic API 文档</a></li> 
        <li class="file"><a href="../6.0.1-modern/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.1 Modern API 文档</a></li> 
        <li class="file"><a href="../6.0.0-classic/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.0 Classic API 文档</a></li> 
        <li class="file"><a href="../6.0.0-modern/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.0 Modern API 文档</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">API 版本差异</a> 
       <ul expand="false"> 
        <li class="file"><a href="../api_diffs/602_classic_diff.html" title="Between 5.1.1 &amp; 6.0.0">Between 6.0.1 &amp; 6.0.2 Classic</a></li> 
        <li class="file"><a href="../api_diffs/602_modern_diff.html" title="Between 5.1.1 &amp; 6.0.0">Between 6.0.1 &amp; 6.0.2 Modern</a></li> 
        <li class="file"><a href="../api_diffs/601_classic_diff.html" title="Between 5.1.1 &amp; 6.0.0">Between 6.0.0 &amp; 6.0.1 Classic</a></li> 
        <li class="file"><a href="../api_diffs/601_modern_diff.html" title="Between Touch 2.4.2 &amp; 6.0.0">Between 6.0.0 &amp; 6.0.1 Modern</a></li> 
        <li class="file"><a href="../api_diffs/600_classic_diff.html" title="Between 5.1.1 &amp; 6.0.0">Between 5.1.1 &amp; 6.0.0 Classic</a></li> 
        <li class="file"><a href="../api_diffs/600_modern_diff.html" title="Between Touch 2.4.2 &amp; 6.0.0">Between Touch 2.4.2 &amp; 6.0.0 Modern</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">Examples</a> 
       <ul expand="false"> 
        <li class="file"><a href="../../../../examples.sencha.com/extjs/6.0.2/examples/default.htm" data-full-load="true" title="">6.0.2 Examples</a></li> 
        <li class="file"><a href="../../../../examples.sencha.com/extjs/6.0.1/examples/default.htm" data-full-load="true" title="">6.0.1 Examples</a></li> 
        <li class="file"><a href="../../../../examples.sencha.com/extjs/6.0.0/examples/default.htm" data-full-load="true" title="">6.0.0 Examples</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">新特性</a> 
       <ul expand="false"> 
        <li class="file"><a href="../whats_new/release_notes.html" title="">版本发布说明</a></li> 
        <li class="file"><a href="../whats_new/whats_new.html" title="">Ext JS 6 新特性</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">升级 &amp; 迁移</a> 
       <ul expand="false"> 
        <li class="file"><a href="../upgrades_migrations/extjs_upgrade_guide.html" title="">Ext JS 5 到 6 - 升级向导</a></li> 
        <li class="file"><a href="../upgrades_migrations/modern_upgrade_guide.html" title="">Touch 2.4 to 6 - 升级向导</a></li> 
        <li class="file"><a href="../upgrades_migrations/pivot_grid_update_guide.html" title="">Ext JS 6 - Pivot Grid 升级向导</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">核心思想</a> 
       <ul expand="false"> 
        <li class="file"><a href="classes.html" title="The 类系统">类系统</a></li> 
        <li class="file"><a href="layouts.html" title="布局和容器">布局和容器</a></li> 
        <li class="file"><a href="components.html" title="Components">Components</a></li> 
        <li class="file"><a href="data_package.html" title="数据封装">数据封装</a></li> 
        <li class="file"><a href="events.html" title="Events in Ext JS">事件和手势</a></li> 
        <li class="file"><a href="drag_drop.html" title="拖放">拖放</a></li> 
        <li class="file"><a href="theming.html" title="Theming Ext JS">主题</a></li> 
        <li class="file"><a href="memory_management.html" title="">内存管理</a></li> 
        <li class="file"><a href="accessibility.html" title="无障碍">无障碍</a></li> 
        <li class="file"><a href="localization.html" title="本地化">本地化</a></li> 
        <li class="file"><a href="rtl.html" title="Right to Left in Ext JS">Right to Left in Ext JS</a></li> 
        <li class="file"><a href="font_ext.html" title="">Sencha 字体包</a><span class="tpl-toc-img-new">★</span></li> 
        <li class="file"><a href="tablet_support.html" title="平板设备支持">平板设备支持</a></li> 
        <li class="folder"><a href="#">绘图封装</a> 
         <ul expand="false"> 
          <li class="file"><a href="draw/drawing.html" title="">绘图封装</a></li> 
          <li class="file"><a href="draw/creating_images_with_draw_pt1.html" title="">Creating Images with Draw - Part 1</a></li> 
          <li class="file"><a href="draw/creating_images_with_draw_pt2.html" title="">Creating Images with Draw - Part 2</a></li> 
          <li class="file"><a href="draw/creating_images_with_draw_pt3.html" title="">Creating Images with Draw - Part 3</a></li> 
         </ul></li> 
       </ul></li> 
      <li class="folder"><a href="#">架构</a> 
       <ul expand="false"> 
        <li class="file"><a href="../application_architecture/application_architecture.html" title="应用程序架构介绍">应用程序架构介绍</a></li> 
        <li class="file"><a href="../application_architecture/developing_for_multiple_screens_and_environments.html" title="应用程序架构介绍">多屏幕开发</a></li> 
        <li class="file"><a href="../application_architecture/view_controllers.html" title="视图控制器View Controllers">视图控制器View Controllers</a></li> 
        <li class="file"><a href="../application_architecture/view_models_data_binding.html" title="View Models &amp; 数据绑定">View Models &amp; 数据绑定</a></li> 
        <li class="file"><a href="../application_architecture/view_model_internals.html" title="View Models Internals">View Model 内部机制</a></li> 
        <li class="file"><a href="../application_architecture/router.html" title="使用路由">使用路由</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">UI 组件</a> 
       <ul expand="false"> 
        <li class="file"><a href="../components/forms.html" title="Forms">Forms</a></li> 
        <li class="file"><a href="../components/introduction_to_charting.html" title="图表Charts介绍">图表Charts介绍</a></li> 
        <li class="file"><a href="../components/trees.html" title="Trees">Trees</a></li> 
        <li class="file"><a href="../components/grids.html" title="Grids">Grids</a></li> 
        <li class="file"><a href="../components/pivot_grid.html" title="Pivot Grid">Pivot Grid</a><span class="tpl-toc-img-new">★</span></li> 
        <li class="file"><a href="../components/widgets_widgets_columns.html" title="Widgets and Widget Columns">Widgets and Widget Columns</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">后台连接</a> 
       <ul expand="false"> 
        <li class="file"><a href="../backend_connectors/soap.html" title="SOAP服务">SOAP服务</a></li> 
        <li class="file"><a href="../backend_connectors/amf.html" title="AMF 数据源">AMF 数据源</a></li> 
        <li class="folder"><a href="#">Ext Direct</a> 
         <ul expand="false"> 
          <li class="file"><a href="../backend_connectors/direct/specification.html" title="Ext Direct 说明">Ext Direct 说明</a><span class="tpl-toc-img-new">★</span></li> 
          <li class="file"><a href="../backend_connectors/direct/mysql_php.html" title="Ext Direct 结合 MySQL 和 PHP">Ext Direct 结合 MySQL 和 PHP</a><span class="tpl-toc-img-new">★</span></li> 
         </ul></li> 
       </ul></li> 
      <li class="folder"><a href="#">其它</a> 
       <ul expand="false"> 
        <li class="file"><a href="../other_resources/oop_concepts.html" title="">OOP基础</a><span class="tpl-toc-img-new">★</span></li> 
        <li class="file"><a href="../other_resources/ecosystem.html" title="">Ext JS 生态</a></li> 
        <li class="file"><a href="../other_resources/sencha_blog.html" title="">来自 Sencha 博客</a></li> 
       </ul></li> 
      <li class="file"><a href="../supported_browsers.html" title="支持的浏览器">支持的浏览器</a></li> 
     </ul> 
    </div> 
   </div> 
   <div id="middle"> 
    <div id="tpl-content"> 
     <div> 
      <div class="toc-page" style="display:block;">
        内容导航 
       <a class="toc-page-h2" href="#Our_Definition" title="Our Definition">我们的定义</a> 
       <a class="toc-page-h3" href="#Language_Framework_Cleanup" title="Language/Framework Cleanup">语言/框架清理工作</a> 
       <a class="toc-page-h3" href="#Repeating_to_exhaustion" title="Repeating to exhaustion">重复执行直到资源耗尽</a> 
       <a class="toc-page-h3" href="#Usage_Grows_Unboundedly" title="Usage Grows Unboundedly">使用量无限制增长</a> 
       <a class="toc-page-h3" href="#Abstraction_and_Garbage_Collection" title="Abstraction and Garbage Collection">抽象和垃圾回收</a> 
       <a class="toc-page-h3" href="#Allocation" title="Allocation">分配</a> 
       <a class="toc-page-h3" href="#Cleanup" title="Cleanup">清理</a> 
       <a class="toc-page-h2" href="#Detecting_Leaks" title="Detecting Leaks">检测内存泄漏</a> 
       <a class="toc-page-h3" href="#Application_Level_Leaks" title="Application Level Leaks">应用程序级别的内存泄漏</a> 
       <a class="toc-page-h3" href="#Framework_Level_Leaks" title="Framework Level Leaks">框架级别的内存泄漏</a> 
       <a class="toc-page-h2" href="#Common_Code_Leak_Patterns_And_Solutions" title="Common Code Leak Patterns And Solutions">常见的引起泄漏的代码和解决方案</a> 
       <a class="toc-page-h3" href="#Preventing_Base_Class_Cleanup" title="Preventing Base Class Cleanup">阻止了基类的清理工作</a> 
       <a class="toc-page-h3" href="#Not_removing_DOM_listeners" title="Not removing DOM listeners">没有移除 DOM 事件监听</a> 
       <a class="toc-page-h3" href="#Keeping_references_to_objects" title="Keeping references to objects">对某个对象的引用一直存在</a> 
       <a class="toc-page-h3" href="#Keeping_References_in_Closures" title="Keeping References in Closures">在闭包中引用对象</a> 
       <a class="toc-page-h3" href="#Continually_creating_instances_with_side_effects" title="Continually creating instances with side effects">不断创建实例带来的副作用</a> 
       <a class="toc-page-h3" href="#Clearing_any_registration_in_a_cache" title="Clearing any registration in a cache">清理缓存(cache)中所有对对象的引用</a> 
       <a class="toc-page-h2" href="#Summary" title="Summary">总结</a> 
      </div> 
      <div id="tpl-content-name" itemprop="name"> 
       <h1>识别内存泄漏</h1> 
      </div> 
      <div id="tpl-content-articleBody" itemprop="articleBody"> 
       <p>在许多情况下都用到过词语 “内存泄漏” . 它通常用来描述内存增长. 维基百科的定义是这样: </p> 
       <p><em>“计算机程序不正确地管理内存分配”.</em></p> 
       <p>这个定义是合理的，但有点模糊.</p> 
       <h2 id="Our_Definition">我们的定义</h2> 
       <p>本指南中, 我们把内存泄露定义为:</p> 
       <p><em>在重复一段代码后，内存使用量会不受限制地增长. 代码必须重复执行直到资源“耗尽” (直到需要回收内存的地步)，并且代码必须保证已经执行了框架的清理工作.</em></p> 
       <p>这有点拗口,所以让我们分解一下这个定义的重要部分:</p> 
       <h3 id="Language_Framework_Cleanup">语言/框架清理工作</h3> 
       <p>根据程序运行的环境, 你需要采取一些行动，来表示你已经完成了某块特定内存的使用. 在 Ext JS 中, 一般是 destroy 函数, 通常用来清理 DOM 元素以及取消绑定事件监听. </p> 
       <p>在 C# 中, 推荐使用 IDisposable 接口. 不管什么平台, 都必须遵循这些约定，以允许平台释放已分配的资源. 如果不采取清理行动, 将会发生内存泄漏，因为平台是不可能知道这些资源是不是不再需要的.</p> 
       <h3 id="Repeating_to_exhaustion">重复执行直到资源耗尽</h3> 
       <p>我们假设有一台剩余 64Gb 空闲内存的开发机器. 有一部分代码运行5次. 通过检查, 每次运行之后，内存使用量都上升 1Mb 并且不被回收. </p> 
       <p>这个现象问题不算太大. 改程序只用了一小部分内存. 但如果这段代码重复执行 50,000 次，而且仍然不回收内存, 结果将完全不一样. 地层系统需要达到足够的压力，才会被迫回收内存.</p> 
       <h3 id="Usage_Grows_Unboundedly">使用量无限制增长</h3> 
       <p>这可能这个定义中最微妙的,也是最重要的一部分. 在许多情况下, 调用 destroy 或其他清理方法可能并不会释放已分配资源. 在 Ext JS 中 this is typically observed in its caches. </p> 
       <p>比如, <a href="../6.0.1-classic/#!/api/Ext.ComponentQuery" data-full-load="true">Ext.ComponentQuery</a> 类是用一个选择器(一个字符串)来搜索组件的. 本质上, 这个字符串选择器被转换成了一个函数，这个函数可以在候选组件上执行. 构造这个函数的代价比较昂贵, 通常这个搜索函数会被执行很多次. 因为这个复用, 生成的函数保留在了内存中. 这里至关重要的一点是,缓存机制是有界的. </p> 
       <p>缓存用的是 最近最少使用算法 (LRU, Least Recently Used). LRU 持续跟踪内存集合中的每一项. 如果某一项被访问了, 它会被排到最前面. LRU 缓存有个最大容量. 当添加一个项目后超过了最大容量, 最近最少使用的项目将被移出缓存. 当移除直到缓存容量大小的时候，缓存又恢复正常. 这种性质的东西留在内存中是没有问题的. 而只在资源被无限制使用的时候才变成大问题.</p> 
       <h3 id="Abstraction_and_Garbage_Collection">抽象和垃圾回收</h3> 
       <p>开发者使用 Ext JS 的时候还远不是真正的内存管理. 更糟的是, 像 Windows 任务管理器 或 Mac 系统活动监视器 这种工具都准确不提供准确的内存消耗信息. 为了更好地理解这里的因果关系,有必要评估下内存管理层面.</p> 
       <h3 id="Allocation">分配</h3> 
       <ul> 
        <li>开发者向框架申请资源 (比如, 创建一个组件).</li> 
        <li>框架向 JavaScript 引擎申请资源 (通常使用 new 操作符 或者 createElement, 等等.).</li> 
        <li>JavaScript 引擎向底层内存管理系统申请资源 (通常是 C++ 内存分配).</li> 
        <li>底层内存管理系统向操作系统申请资源. 这才是我们可以在任务管理器或者活动监视器中可以观察到的.</li> 
       </ul> 
       <h3 id="Cleanup">清理</h3> 
       <ol> 
        <li>开发者调用 Ext JS 组件或其他资源的销毁动作.</li> 
        <li>Ext JS 组件的 destroy 函数调用其他清理函数, 设置一堆内部变量的引用位 null, 等等..</li> 
        <li>JavaScript 垃圾回收器，然后决定何时扫描堆内存并回收内存. 回收动作通常要推迟到当有新的内存请求,而空闲内存又“不足”的时候. 内存管理器可能只是简单地增加堆内存使用量，而不是回收垃圾，因为增加堆内存使用量代价更小, 特别是在应用程序生命周期的初期.</li> 
        <li>当 JavaScript 内存管理器决定要回收垃圾了, 它必须决定回收的内存是留着自己以后用还是归还给底层的进程堆.</li> 
        <li>根据被 JavaScript 内存管理器使用的底层内存管理器(通常是 C++ 内存管理器)，被释放的内存可能被留作以后用，有可能归还给操作系统. 此时才可以看到任务管理器或者活动监视器中发生了更新.</li> 
       </ol> 
       <p>鉴于上述情况, 很明显, JavaScript开发人员几乎不能控制内存管理的大局. 这里面有很多可变因素，而且真正的内存管理只是其中一个很小的部分.</p> 
       <p>本指南的目的, 我们不会继续深究下去. 足以说 JavaScript 堆内存和垃圾回收只是根据它们自己的意愿进行，强制它们以特定的方式执行是不可能的. 我们能做的顶就是确保对象不再被代码或框架引用.</p> 
       <p>所以, 用操作系统的任务管理器或监视器来检查内存使用量和增长量是不必要的.</p> 
       <h2 id="Detecting_Leaks">检测内存泄漏</h2> 
       <h3 id="Application_Level_Leaks">应用程序级别的内存泄漏</h3> 
       <p>当应用程序清理框架资源失败的时候, 可能导致这些对象留在了多个集合中. 这些都是特定于版本的具体细节, 可以检查的地方有:</p> 
       <ul> 
        <li><a href="../6.0.1-classic/#!/api/Ext.ComponentManager" data-full-load="true">Ext.ComponentManager</a></li> 
        <li><a href="../6.0.1-classic/#!/api/Ext.data.StoreManager" data-full-load="true">Ext.data.StoreManager</a></li> 
       </ul> 
       <h3 id="Framework_Level_Leaks">框架级别的内存泄漏</h3> 
       <p>尽管在框架内部做了很大努力来清理资源, 但总有遗漏的地方. 以往的经验看, 最普遍的是 DOM 元素导致的泄露. 如果怀疑是这种情况, <a href="../../../../home.online.nl/jsrosman/default.htm">sIEve</a> 这个工具可以在 IE 浏览器上检查内存泄漏.</p> 
       <p><strong>注意:</strong> 我们强烈建议你优先关注所有的应用程序级别的泄漏，然后再关注更低级别的.</p> 
       <h2 id="Common_Code_Leak_Patterns_And_Solutions">常见的引起泄漏的代码和解决方案</h2> 
       <p>下面的代码片段和描述将突出一些可能会引起问题的滥用内存的方式.</p> 
       <h3 id="Preventing_Base_Class_Cleanup">阻止了基类的清理工作</h3> 
       <p>为了在派生类中清理资源，基类的清理工作可能会不经意地被绕过。 </p> 
       <p>举个例子:</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.define('Foo.bar.CustomButton', {
    extend: 'Ext.button.Button',
    onDestroy: function () {
        // 一些清理工作
    }
});</code></pre> 
       <p><strong>解决办法:</strong> 确保调用了<a href="../6.0.1-classic/#!/api/Ext.Base-method-callParent" data-full-load="true">callParent()</a>, 以执行基类的清理工作.</p> 
       <h3 id="Not_removing_DOM_listeners">没有移除 DOM 事件监听</h3> 
       <p>一个 DOM 元素附加了一个事件监听函数. 不过，当 DOM 元素被销毁(使用改变父元素的innerHTML)的时候, 事件处理函数仍然存在内存中.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.fly(someElement).on('click', doSomething);

someElement.parentNode.innerHTML = '';</code></pre> 
       <p><strong>解决办法:</strong> 保持对重要的元素的引用，然后在不需要它们的时候调用它们的 destroy 函数. </p> 
       <h3 id="Keeping_references_to_objects">对某个对象的引用一直存在</h3> 
       <p>花了很多内存创建了一个类的实例. 实例被销毁之后, 仍然在其它地方有对此实例的引用.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.define('MyClass', {

    constructor: function() {
        this.foo = new SomeLargeObject();
    },

    destroy: function() {
        this.foo.destroy();
    }
});

this.o = new MyClass();
o.destroy();

//  `o` 仍然被`this` 引用， `foo`仍然被 `o` 引用.</code></pre> 
       <p><strong>解决办法:</strong> 把引用设为 null ，以保证内存可以被回收. 此处则是在调用 destroy 之后设置 <code>this.foo = null</code>，并设置<code>this.o = null</code>. </p> 
       <h3 id="Keeping_References_in_Closures">在闭包中引用对象</h3> 
       <p>这种情况更加微妙, 但是和上面的比较像. 闭包里面有对重量级对象的引用，只要闭包仍然被使用，这个对象的内存就不会被释放.</p> 
       <pre mode="javascript" theme="chrome"><code>function runAsync(val) {
    var o = new SomeLargeObject();
    var x = 42;

    // 其他代码

    return function() {
        return x;  // o 位于闭包作用域内，但其实 o 已经用不到了
    }
}

var f = runAsync(1);</code></pre> 
       <p>上述现象的原因，一般是因为这个对象位于闭包的外层作用域，但在内层函数中已不再需要. 这种很容易被遗漏, 但是对内存的使用量会产生负面影响.</p> 
       <p><strong>解决办法:</strong> 使用 <a href="../6.0.1-classic/#!/api/Ext.Function-method-bind" data-full-load="true">Ext.Function.bind()</a> 或者标准 JavaScript 提供的方法 <code>bind</code> 来为外部函数创建安全的闭包.</p> 
       <pre mode="javascript" theme="chrome"><code>function fn (x) {
    return x;
}

function runAsync(val) {
    var o = new SomeLargeObject();
    var x = 42;

    // 其他代码

    return Ext.Function.bind(fn, null, [x]); // o is not captured
}

var f = runAsync(1);</code></pre> 
       <h3 id="Continually_creating_instances_with_side_effects">不断创建实例带来的副作用</h3> 
       <p>创建某些实例可能会有副作用 (比如创建 DOM 元素). 如果不销毁已经有的实例，就去创建新的实例，就会发生内存泄漏.</p> 
       <pre mode="javascript" theme="chrome"><code>{
    xtype: 'treepanel',
    listeners: {
        itemclick: function(view, record, item, index, e) {

            // 总是在此处创建新的Menu
            new Ext.menu.Menu({
                items: [record.get('name')]
            }).showAt(e.getXY());
        }
    }
}</code></pre> 
       <p><strong>解决办法:</strong> 获得对已创建 menu 实例的引用，并在不需要它的时候调用它的 destroy 方法. </p> 
       <h3 id="Clearing_any_registration_in_a_cache">清理缓存(cache)中所有对对象的引用(原文是registration, 注册)</h3> 
       <p>清理所有对某个对象的引用非常重要. 只把局部变量设置为 null 是不够的. 如果某个全局 单例缓存(singleton cache) 中引用了这个对象, 那么这个引用会一直存在于整个应用程序的生命周期.</p> 
       <pre mode="javascript" theme="chrome"><code>var o = new SomeLargeObject();
someCache.register(o);

// 销毁对象并把引用置为 null. someCache 里仍然注册有对该对象的引用
o.destroy();
o = null;</code></pre> 
       <p><strong>解决办法:</strong> 确保在调用了 destroy 之后，清理所有对某个对象的引用.</p> 
       <h2 id="Summary">总结</h2> 
       <p>控制应用程序的内存管理还是比较简单的: 销毁不使用的组件, 把不用的引用置为 null, 并使用 <a href="../6.0.1-classic/#!/api/Ext.Base-method-callParent" data-full-load="true">callParent()</a>. 遵从这些建议，可以让你的应用程序可以正确地使用资源，保证应用程序运行流畅.</p> 
      </div> 
      <div class="tpl-content-lastUpdated">
        Last updated 
       <div id="tpl-content-lastUpdated-date" itemprop="datePublished" datetime="2016-04-01T12:27Z">
         April 1, 2016 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div id="footer"> 
   <div id="footer-social"> 
    <div class="g-plusone" data-size="medium" data-annotation="none"></div> 
   </div> 
   <div id="footer-content"> 
    <a href="../../../../www.sencha.com/products">Products</a> | 
    <a href="../../../../www.sencha.com/services">Services</a> | 
    <a href="../../../../www.sencha.com/support">Support</a> | 
    <a href="../../../../www.sencha.com/training">Training</a> | 
    <a href="../../../../www.sencha.com/partners">Partners</a> | 
    <a href="../../../../www.sencha.com/blog">Community</a> | 
    <a href="../../../../www.sencha.com/company">Company</a> 
   </div> 
  </div> 
  <div id="menu-product-container" style="display:none;"> 
   <div id="menu-dropdown"> 
    <div class="menu-landing-products"> 
     <div id="menu-vertical"> 
      <p class="menu-landing-product" rel="extjs"> <a> Sencha Ext JS </a> </p> 
      <p class="menu-landing-product" rel="cmd"> <a> Sencha Cmd </a> </p> 
      <p class="menu-landing-product" rel="sencha_test"> <a> Sencha Test </a> </p> 
      <p class="menu-landing-product" rel="ide_plugins"> <a> Sencha IDE Plugins </a> </p> 
      <p class="menu-landing-product" rel="sencha_inspector"> <a> Sencha Inspector </a> </p> 
      <p class="menu-landing-product" rel="gxt"> <a> Sencha GXT </a> </p> 
      <p class="menu-landing-product" rel="webappmgr"> <a> Sencha Web Application Manager </a> </p> 
      <p class="menu-landing-product" rel="architect"> <a> Sencha Architect </a> </p> 
      <p class="menu-landing-product" rel="touch"> <a> Sencha Touch </a> </p> 
     </div> 
    </div> 
    <div id="menu-product-details"> 
     <div id="extjs-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Ext JS 
      </div> 
      <div class="menu-landing-doc-heading">
        6.x 
      </div> 
      <a href="../default.htm"> 6.0.2 </a> 
      <a class="menu-landing-zip" style="padding-right:0;" href="../../../downloads/extjs-docs-6.0.2-classic.zip"> (classic) </a> 
      <a class="menu-landing-zip menu-landing-lesspad" href="../../../downloads/extjs-docs-6.0.2-modern.zip"> (modern) </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../default.htm"> 6.0.1 </a> 
      <a class="menu-landing-zip" style="padding-right:0;" href="../../../downloads/extjs-docs-6.0.1-classic.zip"> (classic) </a> 
      <a class="menu-landing-zip menu-landing-lesspad" href="../../../downloads/extjs-docs-6.0.1-modern.zip"> (modern) </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../default.htm"> 6.0.0 </a> 
      <a class="menu-landing-zip" style="padding-right:0;" href="../../../downloads/extjs-docs-6.0.0-classic.zip"> (classic) </a> 
      <a class="menu-landing-zip" style="padding-left:0;" href="../../../downloads/extjs-docs-6.0.0-modern.zip"> (modern) </a> 
      <div class="menu-landing-doc-heading">
        5.1.x 
      </div> 
      <a href="../../5.1/default.htm"> 5.1.2 </a> 
      <a class="menu-landing-zip" href="../../../downloads/extjs-docs-5.1.2.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../5.1/default.htm"> 5.1.1 </a> 
      <a class="menu-landing-zip" href="../../../downloads/extjs-docs-5.1.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../5.1/default.htm"> 5.1.0 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/ext-docs-5.1.0.zip"> (offline docs) </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        5.0.x 
      </div> 
      <a href="../../5.0/default.htm"> 5.0.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/ext-docs-5.0.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../5.0/default.htm"> 5.0.0 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/ext-docs-5.0.0.zip"> (offline docs) </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        4.2.x 
      </div> 
      <a href="../../4.2.5/default.htm"> 4.2.5 </a> 
      <a class="menu-landing-zip" href="../../../downloads/extjs-docs-4.2.5.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.4/default.htm"> 4.2.4 </a> 
      <a class="menu-landing-zip" href="../../../downloads/extjs-docs-4.2.4.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.3/default.htm"> 4.2.3 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/extjs-docs-4.2.3.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.2/default.htm"> 4.2.2 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/extjs-docs-4.2.2.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.1/default.htm"> 4.2.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/extjs-docs-4.2.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.0/default.htm"> 4.2.0 </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        4.1.x 
      </div> 
      <a href="../../4.1.3/default.htm"> 4.1.3 </a> 
      <br /> 
      <a href="../../4.1.2/default.htm"> 4.1.2 </a> 
      <br /> 
      <a href="../../4.1.1/default.htm"> 4.1.1 </a> 
      <br /> 
      <a href="../../4.1.0/default.htm"> 4.1.0 </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        4.0.x 
      </div> 
      <a href="../../4.0.7/default.htm"> 4.0.7 </a> 
      <br /> 
      <a href="../../4.0.0/default.htm"> 4.0.0 </a> 
     </div> 
     <div id="cmd-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Cmd 
      </div> 
      <div class="menu-landing-doc-heading">
        6.x 
      </div> 
      <a href="../../../cmd/6.x"> 6.x </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <div class="menu-landing-doc-heading">
        5.x 
      </div> 
      <a href="../../../cmd/5.x"> 5.x </a> 
     </div> 
     <div id="sencha_test-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Test 
      </div> 
      <a href="../../../sencha_test/index.html"> Sencha Test </a> 
      <span class="tpl-toc-img-new">★</span> 
     </div> 
     <div id="ide_plugins-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha IDE Plugins 
      </div> 
      <a href="../../../ide_plugins/jetbrains_ide_plugin.html"> JetBrains Plugin 6.x </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../../../ide_plugins/eclipse_ide_plugin.html"> Eclipse Plugin </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../../../ide_plugins/visual_studio_ide_plugin.html"> Visual Studio Plugin </a> 
      <span class="tpl-toc-img-new">★</span> 
     </div> 
     <div id="sencha_inspector-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Inspector 
      </div> 
      <a href="../../../sencha_inspector/index.html"> Sencha Inspector 6.x </a> 
      <span class="tpl-toc-img-new">★</span> 
     </div> 
     <div id="gxt-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha GXT 
      </div> 
      <!-- GXT 4.0 --> 
      <div class="menu-landing-doc-heading">
        4.0 
       <span class="tpl-toc-img-new">★</span> 
      </div> 
      <a href="../../../../examples.sencha.com/gxt/4.0.1"> 4.0 Explorer Examples </a> 
      <br /> 
      <a href="../../../../examples.sencha.com/gxt-edash/4.0.1"> 4.0 Dashboard Example </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/gxt/examples-src/gxt-edash-4.0.1.zip"> (War) </a> 
      <br /> 
      <a href="../../../gxt/4.x/default.htm"> 4.0 Guides </a> 
      <br /> 
      <a href="../../../gxt/4.x/javadoc/gxt-4.0.0"> 4.0 Javadoc </a> 
      <br /> 
      <!-- GXT 3.1.x --> 
      <div class="menu-landing-doc-heading">
        3.1 
      </div> 
      <a href="../../../../www.sencha.com/examples/default.htm"> 3.1.4 Examples </a> 
      <br /> 
      <a href="../../../gxt/3.x/default.htm"> 3.1.4 Guides </a> 
      <br /> 
      <a href="../../../gxt/3.x/javadoc"> 3.1.4 Javadoc </a> 
      <br /> 
      <!-- GXT 3.0.x --> 
      <!-- GXT 2.x --> 
      <div class="menu-landing-doc-heading">
        2.0 
      </div> 
      <a href="../../../../https@www.sencha.com/examples-2/default.htm"> 2.3.1 Examples </a> 
     </div> 
     <div id="webappmgr-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Web Application Manager 
      </div> 
      <div class="menu-landing-doc-heading">
        6.0.x 
      </div> 
      <a href="../../../webappmgr"> 6.0.0 </a> 
      <span class="tpl-toc-img-new">★</span> 
     </div> 
     <div id="architect-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Architect 
      </div> 
      <div class="menu-landing-doc-heading">
        3.x 
      </div> 
      <a href="../../../architect/3.5/default.htm"> 3.5 </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../../../architect/3/default.htm"> 3.2 </a> 
      <a class="menu-landing-zip menu-landing-lesspad" href="../../../../cdn.sencha.com/downloads/docs/architect-docs-3.zip"> (offline docs) </a> 
     </div> 
     <div id="touch-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Touch 
      </div> 
      <div class="menu-landing-doc-heading">
        2.4.x 
      </div> 
      <a href="../../../touch/2.4/default.htm"> 2.4.2 </a> 
      <span class="tpl-toc-img-new">★</span> 
      <a class="menu-landing-zip menu-landing-lesspad" href="../../../downloads/touch-docs-2.4.2.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../../touch/2.4/default.htm"> 2.4.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.4.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../../touch/2.4/2.4.0-apidocs"> 2.4.0 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.4.0.zip"> (offline docs) </a> 
      <div class="menu-landing-doc-heading">
        2.3.x 
      </div> 
      <a href="../../../touch/2.3.1/default.htm"> 2.3.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.3.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../../touch/2.3.0/default.htm"> 2.3.0 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.3.0.zip"> (offline docs) </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        2.2.x 
      </div> 
      <a href="../../../touch/2.2.1/default.htm"> 2.2.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.2.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../../touch/2.2.0/default.htm"> 2.2.0 </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        2.1.x 
      </div> 
      <a href="../../../touch/2.1.1/default.htm"> 2.1.1 </a> 
      <br /> 
      <a href="../../../touch/2.1.0/default.htm"> 2.1.0 </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        2.0.x 
      </div> 
      <a href="../../../touch/2.0.2/default.htm"> 2.0.2 </a> 
      <br /> 
      <a href="../../../touch/2.0.1/default.htm"> 2.0.1 </a> 
      <br /> 
      <a href="../../../touch/2.0.0/default.htm"> 2.0.0 </a> 
     </div> 
    </div> 
   </div> 
  </div> 
   
  <script type="text/javascript">
    adroll_adv_id = "5RM2BL5IGRFLRG5VDQ7OIE";
    adroll_pix_id = "LWO7UZXBFVESTOMYFI2LYS";
    /* OPTIONAL: provide email to improve user identification */
    /* adroll_email = "username_40example.com"; */
    (function () {
      var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "../../../../https@s.adroll.com" : "../../../../a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
        document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
      };
      if (window.addEventListener) {window.addEventListener('load', _onload, false);}
      else {window.attachEvent('onload', _onload)}
    }());
  </script> 
  <script>
    var menu = document.getElementById("tpl-toc"),
        link_obj = document.getElementById("mobile_menu_link"),
        links = menu.querySelectorAll('a');

    for(i=0; i < links.length; i++) {
      links[i].onclick = function() {
        var mq = window.matchMedia('only screen and (max-width: 768px)');

        if(mq.matches) {
          menu.style.display = 'none';
          link_obj.innerHTML = 'MENU';
        }
      }
    }

  </script> 
  <script type="text/javascript">
    </script>              <script src='../../../../munchkin.marketo.net/munchkin-beta.js' type='text/javascript'></script><script>Munchkin.init('374-WES-121');</script>   
 
</body></html>