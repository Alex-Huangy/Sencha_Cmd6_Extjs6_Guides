<!DOCTYPE html><html><head> 
  <link href="../css/main.css" rel="stylesheet" type="text/css" /> 
  <script type="text/javascript" src="../MarkdownWebapp/MarkdownWebapp.nocache.js"></script> 
  <script type="text/javascript" src="../ace/ace.js"></script> 
  <link rel="icon" type="image/x-icon" href="../favicon.ico" /> 
  <script type="text/javascript">window["_GOOG_TRANS_EXT_VER"] = "1";</script> 
  <title>Ext JS 向导 | View Models &amp; 数据绑定</title> 
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" /> 
  <script async="" type="text/javascript" src="../../../../https@use.typekit.com/bqo8qzg.js"></script> 
  <script type="text/javascript">

    function showMenu(link_obj){
      var menu = document.getElementById("tpl-toc");

      link_obj.innerHTML = (link_obj.innerHTML == 'CLOSE MENU') ? 'MENU' : 'CLOSE MENU';

      if(menu.style.display == 'block'){
         menu.style.display = 'none';
      }else{
         menu.style.display = 'block';
      }
    }

  </script> 
 </head> 
 <body> 
  <div id="header"> 
   <a href="../../../../www.sencha.com/default.htm"><img class="sencha-logo" src="../images/logo.png" /></a> 
   <h1 id="current-product"><a href="#">Ext JS 向导 ▼</a></h1> 
   <div id="mobile_menu"> 
    <a id="mobile_menu_link" onclick="showMenu(this);" href="#">MENU</a> 
   </div> 
    
  </div> 
  <div id="content" itemscope="" itemtype="http://schema.org/Article"> 
   <div id="tpl-toc"> 
    <div id="tpl-toc-content"> 
     <a class="toggle-button" href="#">expand</a> 
     <ul> 
      <li class="file"><a href="../../../default.htm" data-full-load="true" title="Home">Sencha 向导</a></li> 
      <li class="file"><a href="../index.html" title="Guide Home">Sencha Ext JS 向导</a></li> 
      <li class="folder"><a href="#">快速入门</a> 
       <ul expand="false"> 
        <li class="file"><a href="../getting_started/getting_started.html" title="Get Started">安装 &amp; 快速入门</a></li> 
        <li class="file"><a href="../getting_started/extjs_faq.html" title="">Ext JS - 问答</a></li> 
        <li class="file"><a href="../getting_started/login_app.html" title="">创建一个简单的登录应用</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">Ext JS 6 API 文档</a> 
       <ul expand="false"> 
        <li class="file"><a href="../6.0.2-classic/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.2 Classic API 文档</a></li> 
        <li class="file"><a href="../6.0.2-modern/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.2 Modern API 文档</a></li> 
        <li class="file"><a href="../6.0.1-classic/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.1 Classic API 文档</a></li> 
        <li class="file"><a href="../6.0.1-modern/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.1 Modern API 文档</a></li> 
        <li class="file"><a href="../6.0.0-classic/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.0 Classic API 文档</a></li> 
        <li class="file"><a href="../6.0.0-modern/default.htm" data-full-load="true" title="Api Docs">Ext JS 6.0.0 Modern API 文档</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">API 版本差异</a> 
       <ul expand="false"> 
        <li class="file"><a href="../api_diffs/602_classic_diff.html" title="Between 5.1.1 &amp; 6.0.0">Between 6.0.1 &amp; 6.0.2 Classic</a></li> 
        <li class="file"><a href="../api_diffs/602_modern_diff.html" title="Between 5.1.1 &amp; 6.0.0">Between 6.0.1 &amp; 6.0.2 Modern</a></li> 
        <li class="file"><a href="../api_diffs/601_classic_diff.html" title="Between 5.1.1 &amp; 6.0.0">Between 6.0.0 &amp; 6.0.1 Classic</a></li> 
        <li class="file"><a href="../api_diffs/601_modern_diff.html" title="Between Touch 2.4.2 &amp; 6.0.0">Between 6.0.0 &amp; 6.0.1 Modern</a></li> 
        <li class="file"><a href="../api_diffs/600_classic_diff.html" title="Between 5.1.1 &amp; 6.0.0">Between 5.1.1 &amp; 6.0.0 Classic</a></li> 
        <li class="file"><a href="../api_diffs/600_modern_diff.html" title="Between Touch 2.4.2 &amp; 6.0.0">Between Touch 2.4.2 &amp; 6.0.0 Modern</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">Examples</a> 
       <ul expand="false"> 
        <li class="file"><a href="../../../../examples.sencha.com/extjs/6.0.2/examples/default.htm" data-full-load="true" title="">6.0.2 Examples</a></li> 
        <li class="file"><a href="../../../../examples.sencha.com/extjs/6.0.1/examples/default.htm" data-full-load="true" title="">6.0.1 Examples</a></li> 
        <li class="file"><a href="../../../../examples.sencha.com/extjs/6.0.0/examples/default.htm" data-full-load="true" title="">6.0.0 Examples</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">新特性</a> 
       <ul expand="false"> 
        <li class="file"><a href="../whats_new/release_notes.html" title="">版本发布说明</a></li> 
        <li class="file"><a href="../whats_new/whats_new.html" title="">Ext JS 6 新特性</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">升级 &amp; 迁移</a> 
       <ul expand="false"> 
        <li class="file"><a href="../upgrades_migrations/extjs_upgrade_guide.html" title="">Ext JS 5 到 6 - 升级向导</a></li> 
        <li class="file"><a href="../upgrades_migrations/modern_upgrade_guide.html" title="">Touch 2.4 to 6 - 升级向导</a></li> 
        <li class="file"><a href="../upgrades_migrations/pivot_grid_update_guide.html" title="">Ext JS 6 - Pivot Grid 升级向导</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">核心思想</a> 
       <ul expand="false"> 
        <li class="file"><a href="../core_concepts/classes.html" title="The 类系统">类系统</a></li> 
        <li class="file"><a href="../core_concepts/layouts.html" title="布局和容器">布局和容器</a></li> 
        <li class="file"><a href="../core_concepts/components.html" title="Components">Components</a></li> 
        <li class="file"><a href="../core_concepts/data_package.html" title="数据封装">数据封装</a></li> 
        <li class="file"><a href="../core_concepts/events.html" title="Events in Ext JS">事件和手势</a></li> 
        <li class="file"><a href="../core_concepts/drag_drop.html" title="拖放">拖放</a></li> 
        <li class="file"><a href="../core_concepts/theming.html" title="Theming Ext JS">主题</a></li> 
        <li class="file"><a href="../core_concepts/memory_management.html" title="">内存管理</a></li> 
        <li class="file"><a href="../core_concepts/accessibility.html" title="无障碍">无障碍</a></li> 
        <li class="file"><a href="../core_concepts/localization.html" title="本地化">本地化</a></li> 
        <li class="file"><a href="../core_concepts/rtl.html" title="Right to Left in Ext JS">Right to Left in Ext JS</a></li> 
        <li class="file"><a href="../core_concepts/font_ext.html" title="">Sencha 字体包</a><span class="tpl-toc-img-new">★</span></li> 
        <li class="file"><a href="../core_concepts/tablet_support.html" title="平板设备支持">平板设备支持</a></li> 
        <li class="folder"><a href="#">绘图封装</a> 
         <ul expand="false"> 
          <li class="file"><a href="../core_concepts/draw/drawing.html" title="">绘图封装</a></li> 
          <li class="file"><a href="../core_concepts/draw/creating_images_with_draw_pt1.html" title="">Creating Images with Draw - Part 1</a></li> 
          <li class="file"><a href="../core_concepts/draw/creating_images_with_draw_pt2.html" title="">Creating Images with Draw - Part 2</a></li> 
          <li class="file"><a href="../core_concepts/draw/creating_images_with_draw_pt3.html" title="">Creating Images with Draw - Part 3</a></li> 
         </ul></li> 
       </ul></li> 
      <li class="folder"><a href="#">架构</a> 
       <ul expand="false"> 
        <li class="file"><a href="application_architecture.html" title="应用程序架构介绍">应用程序架构介绍</a></li> 
        <li class="file"><a href="developing_for_multiple_screens_and_environments.html" title="应用程序架构介绍">多屏幕开发</a></li> 
        <li class="file"><a href="view_controllers.html" title="视图控制器View Controllers">视图控制器View Controllers</a></li> 
        <li class="file"><a href="view_models_data_binding.html" title="View Models &amp; 数据绑定">View Models &amp; 数据绑定</a></li> 
        <li class="file"><a href="view_model_internals.html" title="View Models Internals">View Model 内部机制</a></li> 
        <li class="file"><a href="router.html" title="使用路由">使用路由</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">UI 组件</a> 
       <ul expand="false"> 
        <li class="file"><a href="../components/forms.html" title="Forms">Forms</a></li> 
        <li class="file"><a href="../components/introduction_to_charting.html" title="图表Charts介绍">图表Charts介绍</a></li> 
        <li class="file"><a href="../components/trees.html" title="Trees">Trees</a></li> 
        <li class="file"><a href="../components/grids.html" title="Grids">Grids</a></li> 
        <li class="file"><a href="../components/pivot_grid.html" title="Pivot Grid">Pivot Grid</a><span class="tpl-toc-img-new">★</span></li> 
        <li class="file"><a href="../components/widgets_widgets_columns.html" title="Widgets and Widget Columns">Widgets and Widget Columns</a></li> 
       </ul></li> 
      <li class="folder"><a href="#">后台连接</a> 
       <ul expand="false"> 
        <li class="file"><a href="../backend_connectors/soap.html" title="SOAP服务">SOAP服务</a></li> 
        <li class="file"><a href="../backend_connectors/amf.html" title="AMF 数据源">AMF 数据源</a></li> 
        <li class="folder"><a href="#">Ext Direct</a> 
         <ul expand="false"> 
          <li class="file"><a href="../backend_connectors/direct/specification.html" title="Ext Direct 说明">Ext Direct 说明</a><span class="tpl-toc-img-new">★</span></li> 
          <li class="file"><a href="../backend_connectors/direct/mysql_php.html" title="Ext Direct 结合 MySQL 和 PHP">Ext Direct 结合 MySQL 和 PHP</a><span class="tpl-toc-img-new">★</span></li> 
         </ul></li> 
       </ul></li> 
      <li class="folder"><a href="#">其它</a> 
       <ul expand="false"> 
        <li class="file"><a href="../other_resources/oop_concepts.html" title="">OOP基础</a><span class="tpl-toc-img-new">★</span></li> 
        <li class="file"><a href="../other_resources/ecosystem.html" title="">Ext JS 生态</a></li> 
        <li class="file"><a href="../other_resources/sencha_blog.html" title="">来自 Sencha 博客</a></li> 
       </ul></li> 
      <li class="file"><a href="../supported_browsers.html" title="支持的浏览器">支持的浏览器</a></li> 
     </ul> 
    </div> 
   </div> 
   <div id="middle"> 
    <div id="tpl-content"> 
     <div> 
      <div class="toc-page" style="display:block;">
        内容导航 
       <a class="toc-page-h2" href="#Component_Binding" title="Component Binding">组件绑定</a> 
       <a class="toc-page-h3" href="#Binding_and_Configs" title="Binding and Configs">绑定 和 配置项(configs)</a> 
       <a class="toc-page-h3" href="#Binding_Boolean_Configs" title="Binding Boolean Configs">绑定 布尔类型(Boolean) 配置项</a> 
       <a class="toc-page-h3" href="#Binding_and_Priority" title="Binding and Priority">绑定和优先级</a> 
       <a class="toc-page-h3" href="#Binding_and_Child_Components" title="Binding and Child Components">绑定和子组件</a> 
       <a class="toc-page-h3" href="#Two_Way_Binding" title="Two Way Binding">双向绑定</a> 
       <a class="toc-page-h3" href="#Binding_and_Component_State" title="Binding and Component State">绑定和控件状态</a> 
       <a class="toc-page-h3" href="#Bind_Descriptors" title="Bind Descriptors">绑定描述符(Bind Descriptors)</a> 
       <a class="toc-page-h4" href="#Multi_Bind" title="Multi-Bind">多值绑定(Multi-Bind)</a> 
       <a class="toc-page-h4" href="#Record_Bind" title="Record Bind">Record 绑定</a> 
       <a class="toc-page-h4" href="#Association_Bind" title="Association Bind">关联(Association) 绑定</a> 
       <a class="toc-page-h4" href="#Bind_Options" title="Bind Options">与绑定相关的选项(Bind Options)</a> 
       <a class="toc-page-h2" href="#Creating_ViewModels" title="Creating ViewModels">创建视图模型(ViewModels)</a> 
       <a class="toc-page-h3" href="#Formulas" title="Formulas">方程式(Formulas)</a> 
       <a class="toc-page-h4" href="#Formulas_With_Explicit_Binding" title="Formulas With Explicit Binding">显式绑定 Formulas</a> 
       <a class="toc-page-h4" href="#Two_Way_Formulas" title="Two-Way Formulas">双向 Formulas</a> 
       <a class="toc-page-h3" href="#Recommendations" title="Recommendations">建议</a> 
      </div> 
      <div id="tpl-content-name" itemprop="name"> 
       <h1>视图模型(View Models)和数据绑定</h1> 
      </div> 
      <div id="tpl-content-articleBody" itemprop="articleBody"> 
       <p>数据绑定和 视图模型(ViewModel) 是对 Ext JS 的强有力的补充.<br />以声明式的书写方式, 它们使您能够用很少的代码做更多的事情, 以便让你集中精力关注其它更重要的逻辑.</p> 
       <p>视图模型(View Model) 是一个管理数据对象的类. 需要这些数据的组件可以绑定到 View Model, 而且可以在数据发生变化的时候通知组件更新界面. 视图模型(View Model) 和 视图控制器(ViewController)类似, 只被引用了它的 view 所拥有. 因为 ViewModels 和 view 关联, 视图模型可以链接到父视图模型(view的父容器的视图模型). 这样，子视图就可以用从父视图模型“继承”过来的数据.</p> 
       <p>组件有一个 <code>bind</code> 配置, 此配置允许它们把自身的一些配置项与 ViewModel 的数据关联起来. 使用 bind, 如果数据发生变化, 组件相应的配置项会触发调用 setter 方法 - 而不需要用自定义事件监听函数来处理.</p> 
       <p>在这篇指南中, 我们会通过一些例子来展示视图模型(View Models)和数据绑定的强大之处.</p> 
       <h2 id="Component_Binding">组件绑定</h2> 
       <p>理解绑定和 ViewModels 的最好的途径应该是看看各种绑定组件的方式. 因为组件是数据绑定的主要"消费者", 在这一点上组件和 Ext JS 开发者有相似之处. 为了实现绑定，我们需要一个 ViewModel, 我们现在先引用它, 待会再定义 ViewModel 类.</p> 
       <h3 id="Binding_and_Configs">绑定 和 配置项(configs)</h3> 
       <p>绑定组件, 其实是把 <a href="../6.0.1-classic/#!/api/Ext.app.ViewModel" data-full-load="true">Ext.app.ViewModel</a> 的数据 和组件的配置项(config) 联系起来的过程. 一个组件的任何配置都可以绑定，只要它有一个 setter 方法. 比如, 因为 <a href="../6.0.1-classic/#!/api/Ext.panel.Panel" data-full-load="true">Ext.panel.Panel</a> 有个 <code>setTitle()</code> 方法 , 所以你可以绑定<code>title</code> 配置项.</p> 
       <p>在这个例子中, 我们会根据 ViewModel 的<code>data</code>来设置 panel 的<code>width</code>. 我们把数据绑定到 <code>width</code> 上，因为 <code>Ext.panel.Panel</code> 有 <code>setWidth()</code> 方法.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.panel.Panel', {
    title: 'Simple Form',

    viewModel: {
        type: 'test'  // we will define the &quot;test&quot; ViewModel soon
    },

    bind: {
        html: '&lt;p&gt;Hello {name}&lt;/p&gt;',
        width: '{someWidth}'
    }
});</code></pre> 
       <p>绑定值的语法和 <a href="../6.0.1-classic/#!/api/Ext.Template" data-full-load="true">Ext.Template</a>非常像. 绑定的字段放在大括号内. 你也可以用 formatters 格式化值, 类似<code>Ext.Template</code>. 不过，和 <code>Ext.Template</code>不同的是, 如果绑定模板是单个的标记(比如‘{someWidth}’), 那么绑定的值是原样传递的, 不会转换为字符串</p> 
       <p>稍后我们会看到 <code>name</code> 和 <code>someWidth</code>的数据是如何定义的. 上面的例子只是简单演示组件如果使用数据.</p> 
       <h3 id="Binding_Boolean_Configs">绑定 布尔类型(Boolean) 配置项</h3> 
       <p>有很多配置项的值是布尔类型(Boolean), 比如 visible (或 <code>hidden</code>), <code>disabled</code>, <code>checked</code>, 和 <code>pressed</code>. 只有绑定模板支持布尔否定形式的“内联”表达式. 其它的形式则应该归为 方程(formulas) (见下文), 只不过布尔反转很常见, 所以对它有特殊的规定. 例如:</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.panel.Panel', {
    title: 'Simple Form',

    viewModel: {
        type: 'test'
    },

    items: [{
        xtype: 'button',
        bind: {
            hidden: '{!name}'  // 否定
        }
    }]
});</code></pre> 
       <p>此处再次强调了单个标记模板中的值, 是不会转换为字符串的. 上面的例子中, 因为 “name”是个字符串值, 使用 “!”否定反转，变成了 boolean 值，然后传递给了 button 的 <code>setHidden</code> 方法.</p> 
       <h3 id="Binding_and_Priority">绑定和优先级</h3> 
       <p>绑定配置项总是会覆盖掉静态写的配置项值. 也就是说, 绑定数据的优先级比静态配置值要高, 但是为了获取数据可能会延迟绑定。</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.panel.Panel', {
    title: 'Simple Form',

    viewModel: {
        type: 'test'
    },

    bind: {
        title: 'Hello {name}'
    }
});</code></pre> 
       <p>只要传递了值给绑定的“name”, “Simple Form” 的 title 就会被替换.</p> 
       <h3 id="Binding_and_Child_Components">绑定和子组件</h3> 
       <p>绑定的一个很有用的部分就是, 拥有 viewModel 的容器中, 它的所有子组件也可以访问该容器的数据.</p> 
       <p>这个例子中, 你可以看到 form 的子 items 绑定到了父容器的 viewModel.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.panel.Panel', {
    title: 'Simple Form',

    viewModel: {
        type: 'test'
    },

    layout: 'form',
    defaultType: 'textfield',

    items: [{
        fieldLabel: 'First Name',
        bind: '{firstName}' // 使用父容器的 &quot;test&quot; ViewModel
    },{
        fieldLabel: 'Last Name',
        bind: '{lastName}'
    }]
});</code></pre> 
       <h3 id="Two_Way_Binding">双向绑定</h3> 
       <p>bind 配置项支持双向绑定, 也就是 view 和 viewModel 之间数据是实时同步的. View 里面的数据变更都会自动写回 viewModel. 而且也会自动更新绑定了此数据的其它组件. <strong>注意:</strong> 并不是所有的配置项都会在发生变更时把它们的值 反映(publish) 给 ViewModel.<br />只有定义在 <code>publish</code> 和 <code>twoWayBindable</code> 数组中的 配置项才会把变更 反映(publish) 给 ViewModel. 也可以用 <code>publishState</code> 函数把值的变更反映给 ViewModel.</p> 
       <p>上面的例子中, 因为“firstName”和 “lastName” 属性绑定到了 文本框(text fields), 文本框中内容的改变会写回 ViewModel. 为了了解它们是如果工作的, 我们来完善这个例子并定义这个 ViewModel.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.define('MyApp.view.TestViewModel', {
    extend: 'Ext.app.ViewModel',

    alias: 'viewmodel.test', // 下面会关联到这个 viewModel/type

    data: {
        firstName: 'John',
        lastName: 'Doe'
    },

    formulas: {
        // 我们很快会解释关于 formulas 的详细内容
        name: function (get) {
            var fn = get('firstName'), ln = get('lastName');
            return (fn &amp;&amp; ln) ? (fn + ' ' + ln) : (fn || ln || '');
        }
    }
});

Ext.define('MyApp.view.TestView', {
    extend: 'Ext.panel.Panel',
    layout: 'form',

    // Always use this form when defining a view class. This
    // allows the creator of the component to pass data without
    // erasing the ViewModel type that we want.
    viewModel: {
        type: 'test'  // 引用别名 &quot;viewmodel.test&quot;
    },

    bind: {
        title: 'Hello {name}'
    },

    defaultType: 'textfield',
    items: [{
        fieldLabel: 'First Name',
        bind: '{firstName}'
    },{
        fieldLabel: 'Last Name',
        bind: '{lastName}'
    },{
        xtype: 'button',
        text: 'Submit',
        bind: {
            hidden: '{!name}'
        }
    }]
});

Ext.onReady(function () {
    Ext.create('MyApp.view.TestView', {
        renderTo: Ext.getBody(),
        width: 400
    });
});</code></pre> 
       <p>当上面的 panel 显示出来之后, 我们可以看到 输入框 改变内容会反映到 panel 的 <code>标题(title)</code>上, 也会影响“Submit” 按钮的<code>隐藏/显示(hidden)</code> 状态.</p> 
       <h3 id="Binding_and_Component_State">绑定和控件状态</h3> 
       <p>有时候组件的状态, 比如, checkbox 的<code>勾选(checked)</code> 状态, 或者 表格(grid) 选择行, 需要关联到其它的组件. 如果给一个组件赋予了一个 <code>reference</code> 来标识它, 这个组件就会把它自身的某些属性 反映(publish) 给 ViewModel.</p> 
       <p>下面的例子里, 有一个 label 是“Admin Key”的 文本框(textfield), 它的 disabled 配置项绑定到了 checkbox 的 勾选(checked) 状态上. 结果就是 checkbox 勾选之后, 文本框才变成可输入. 这种行为是非常适合动态表单:</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.panel.Panel', {
    title: 'Sign Up Form',

    viewModel: {
        type: 'test'
    },

    items: [{
        xtype: 'checkbox',
        boxLabel: 'Is Admin',
        reference: 'isAdmin'
    },{
        xtype: 'textfield',
        fieldLabel: 'Admin Key',
        bind: {
            disabled: '{!isAdmin.checked}'
        }
    }]
});</code></pre> 
       <h3 id="Bind_Descriptors">绑定描述符(Bind Descriptors)</h3> 
       <p>目前为止我们见过绑定描述符的3种基本形式:</p> 
       <ul> 
        <li><p><code>{firstName}</code> - “直接绑定”到 ViewModel 的某个值. 值原样传递, 类型不变.</p></li> 
        <li><p><code>Hello {name}</code> - “绑定模板” 总是通过插入各种绑定表达式的文本值来产生一个字符串. 绑定模板也可以用 formatters, 类似<code>Ext.Template</code>, 比如: ‘Hello {name:capitalize}’(作用是首字母大写).</p></li> 
        <li><p><code>{!isAdmin.checked}</code> - 直接绑定的否定形式, 用于绑定布尔(boolean)值.</p></li> 
       </ul> 
       <p>除了这些基本的形式之外，还有一些专门的绑定描述符的形式，可供使用.</p> 
       <h4 id="Multi_Bind">多值绑定(Multi-Bind)</h4> 
       <p>如果给绑定描述符的是一个对象或者数组,  ViewModel 会生成一个同样结构的对象或数组, 里面的属性值都替换成了绑定结果. 比如:</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.Component', {
    bind: {
        data: {
            fname: '{firstName}',
            lname: '{lastName}'
        }
    }
});</code></pre> 
       <p>这段代码, 给组件的 “data” 配置绑定了一个对象, 对象中两个属性值来自 ViewModel.</p> 
       <h4 id="Record_Bind">Record 绑定</h4> 
       <p>但需要绑定一个特定的 record, 比如 <code>id</code>是42的 “User”记录, 绑定描述符需要是一个对象, 对象中有一个“reference” 属性. 例如:</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.Component', {
    bind: {
        data: {
            reference: 'User',
            id: 42
        }
    }
});</code></pre> 
       <p>在这种情况下, 组件的 <code>tpl</code> 会接收到 User 这条记录(record). 需要 requires <code>Ext.data.Session</code>.</p> 
       <h4 id="Association_Bind">关联(Association) 绑定</h4> 
       <p>和 Record 绑定 类似, 也可以绑定到 record 的 关联(关系/外键)(association) 上, 比如和 User 关联的 Address 记录:</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.Component', {
    bind: {
        data: {
            reference: 'User',
            id: 42,
            association: 'address'
        }
    }
});</code></pre> 
       <p>在这种情况下, 组件的 <code>tpl</code> 会接收到 User 这条 record 关联的“address”record. 同样需要 requires <code>Ext.data.Session</code>.</p> 
       <h4 id="Bind_Options">与绑定相关的选项(Bind Options)</h4> 
       <p>当你需要描述绑定设置的时候, 需要用到绑定描述符的最后一种形式. 下面的例子演示了 如何对一个值只绑定一次，之后就自动断开绑定关系.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.Component', {
    bind: {
        data: {
            bindTo: '{name}',
            single: true
        }
    }
});</code></pre> 
       <p><code>bindTo</code> 属性是绑定描述符对象中的第二个保留关键字(第一个保留关键字是 <code>reference</code>). 如果对象中有 <code>bindTo</code> 属性,  意味着 <code>bindTo</code>的值是真正的描述符, 而其它属性是用来配置绑定设置的.</p> 
       <p>另一个可用的绑定选项是 <code>deep</code>. 这个选项表示, 当绑定到一个对象的时候, 对象中任意属性发生变化都会通知绑定, 而并不只是在对象的引用发生变化的时候. 这个通常对绑定 <code>data</code> 配置项比较有用, 因为这个配置项经常接收对象.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.create('Ext.Component', {
    bind: {
        data: {
            bindTo: '{someObject}',
            deep: true
        }
    }
});</code></pre> 
       <h2 id="Creating_ViewModels">创建视图模型(ViewModels)</h2> 
       <p>现在我们已经尝试过了组件如何使用 ViewModels, 也看到过了 ViewModels 的样子, 是时候学习更多关于 ViewModels 的内容了.</p> 
       <p>如前所述, ViewModel 用来管理底层 <code>data</code> 对象. 它是被绑定语句所使用的对象的内容. 利用 JavaScript 原型链继承, 子 ViewModels 会从父 ViewModels那里继承数据. <a href="view_model_internals.html">View Model 内部机制</a> 里面有详细介绍, 但总而言之, 子ViewModel 的 <code>data</code> 对象把父 ViewModel 的 <code>data</code> 对象作为它自身的 原型(prototype).</p> 
       <h3 id="Formulas">方程式(Formulas)</h3> 
       <p>除了保持(hold)数据和提供绑定, ViewModels 还提供了一种方便的方法, 叫做 <code>formulas</code>, 来从其他数据计算得到某些数据. Formulas 让你可以在 ViewModel 中封装数据依赖, 让你的焦点关注在 view 的类结构上. </p> 
       <p>换句话说,  ViewModel 里的 data 并没有变化, 但是可以使用 formulas 进行转换，从而显示成不同的结果. 这个和 model 中 field 的 <code>convert</code> 配置很像.</p> 
       <p>在之前的例子中我们看到了一个简单的“name”这个 formula. 这里的“name” formula 只是一个简单的函数，用于拼接 ViewModel 里“firstName” 和 “lastName”的值.</p> 
       <p>Formulas 也可以使用其它 formulas 的结果，就像 formulas 的结果就是 data 的一个属性一样. 例如:</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.define('MyApp.view.TestViewModel2', {
    extend: 'Ext.app.ViewModel',

    alias: 'viewmodel.test2',

    formulas: {
        x2y: function (get) {
            return get('x2') * get('y');
        },

        x2: function (get) {
            return get('x') * 2;
        }
    }
});</code></pre> 
       <p>“x2” 这个 formulas 使用了 “x” 属性乘以2得到 “x2”. “x2y”这个 formulas 使用“x2” 和“y”. 这个定义意味着, 如果“x” 发生改变, “x2”会重新计算, 然后“x2y”也会重新计算. 但是如果“y” 变了, 只有 “x2y”会被重新计算.</p> 
       <h4 id="Formulas_With_Explicit_Binding">显式绑定 Formulas</h4> 
       <p>在上面的例子中, formula 所依赖的东西是由函数来检查的, 但这并不总是最好的解决方案. 可以用显式的绑定声明, 将所有的值用一个简单对象返回.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.define('MyApp.view.TestViewModel2', {
    extend: 'Ext.app.ViewModel',

    alias: 'viewmodel.test2',

    formulas: {
        something: {
            bind: {
                x: '{foo.bar.x}',
                y: '{bar.foo.thing.zip.y}'
            },

            get: function (data) {
                return data.x + data.y;
            }
        }
    }
});</code></pre> 
       <h4 id="Two_Way_Formulas">双向 Formulas</h4> 
       <p>如果一个 formula 是可逆的, 当我们可以定义一个 <code>set</code> 函数，当值发生改变的时候, 调用<code>set</code> 函数(即双向绑定). 因为“this” 指向的是 ViewModel, 可以调用<code>this.set()</code> 来给 ViewModel 相应的属性赋值.</p> 
       <p>下面 TestViewModel 修改后的版本展示了如何定义“name” 为双向 formula.</p> 
       <pre mode="javascript" theme="chrome"><code>Ext.define('MyApp.view.TestViewModel', {
    extend: 'Ext.app.ViewModel',

    alias: 'viewmodel.test',

    formulas: {
        name: {
            get: function (get) {
                var fn = get('firstName'), ln = get('lastName');
                return (fn &amp;&amp; ln) ? (fn + ' ' + ln) : (fn || ln || '');
            },

            set: function (value) {
                var space = value.indexOf(' '),
                    split = (space &lt; 0) ? value.length : space;

                this.set({
                    firstName: value.substring(0, split),
                    lastName: value.substring(split + 1)
                });
            }
        }
    }
});</code></pre> 
       <h3 id="Recommendations">建议</h3> 
       <p>强大的 ViewModels, formulas, 和数据绑定, 很容易导致滥用这些机制，导致创建出来一个很难理解很难调试的应用程序, 或者更新慢、内存泄漏. 为了避免这些问题, 却又能充分利用 ViewModels,  这里有一些推荐的技术:</p> 
       <ul> 
        <li><p><strong>尽可能使用下面的形式来配置 viewModel.</strong> 主要原因是因为 配置系统(Config System) 合并 config 值的方式. 使用这种形式, “type” 属性在合并过程中会被保留.</p> <pre mode="javascript" theme="chrome"><code>Ext.define('MyApp.view.TestView', {
    //...
    viewModel: {
        type: 'test'
    },
});</code></pre></li> 
        <li><p><strong>定好名字</strong>, 特别是级别高的 ViewModels. 在 JavaScript 我们会依靠文本搜索，所以取可以见名知义的名字. 代码里某个属性用得越多, 取个有意义甚至独一无二的名字就越重要.</p></li> 
        <li><p><strong>除非很必要, 对象中的数据不要嵌套太深.</strong> ViewModel 存储多个顶级(top-level)对象，比存储嵌套层次太深的对象，比对(检测数据变化)的次数要少. 此外, 相比较于 许多组件依赖大对象 来说, 这种方式可以使数据绑定的依赖性更明显. 有时候是会共享对象, 但是记住 ViewModel 只是一个管理数据的对象, 你也可以使用它的属性.</p></li> 
        <li><p><strong>使用子 ViewModels, 以便在组件销毁时可以清理数据</strong> . 如果你把所有数据都放在了顶层 ViewModels, 数据可能永远不会被清除, 即使子视图已被销毁. 相反, 应该创建子视图的 ViewModels,  然后把数据存在子视图的 ViewModel 中.</p></li> 
        <li><p><strong>只在必要的时候创建子 ViewModels.</strong> 每一个 ViewModel 实例的创建都会耗时、占内存. 如果子视图不需要特有的数据, 它可以简单地使用父容器的 ViewModel. 不过还是要看看上一条建议, 因为创建子 ViewModels, 比把什么都塞进父 ViewModel 要好, 也不容易出现内存泄漏问题.</p></li> 
        <li><p><strong>使用 formulas 代替重复绑定.</strong>如果你了解了 formulas 是如何结合多个绑定值的, 你可能会发现使用 formula 可以减少很多重复的绑定. 例如, 有一个 formula 里有3个依赖, 有4个用户使用, 这导致 ViewModel 需要跟踪 <code>3 + 4 = 7</code> 个依赖. 相比较于 4 个用户 分别使用 3 个依赖, 那么最后就产生了 <code>3 * 4 = 12</code> 个依赖. 需要跟踪的依赖少了, 意味着内存占用少了, 耗时也少了.</p></li> 
        <li><p><strong>formulas 链不要太深.</strong> 这与其说是一个运行时间成本问题, 还不如看作是代码可读性问题. formulas 链会掩盖数据和组件之间的联系, 使得难以理解正在发生的事情.</p></li> 
        <li><p><strong>双向 formulas 必须稳定.</strong> 假设 formula “foo” 通过 “bar”的值计算而来. 当“foo”被 set 赋值了, formula 会反转 get 函数 给“bar”赋值. 如果“foo”的 get 函数得到的值和刚刚被 set 的值是一模一样的, 那么这个结果就是稳定的. 如果不稳定, 这个过程会持续循环下去, 直到达到稳定状态, 或者无限期继续下去. 这两种情形都不是令人满意的.</p></li> 
       </ul> 
       <h1>延伸阅读</h1> 
       <p>更多关于 viewModels 的内容, 请看<a href="view_model_internals.html">ViewModel 内部机制</a>.</p> 
      </div> 
      <div class="tpl-content-lastUpdated">
        Last updated 
       <div id="tpl-content-lastUpdated-date" itemprop="datePublished" datetime="2016-04-01T12:27Z">
         April 1, 2016 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div id="footer"> 
   <div id="footer-social"> 
    <div class="g-plusone" data-size="medium" data-annotation="none"></div> 
   </div> 
   <div id="footer-content"> 
    <a href="../../../../www.sencha.com/products">Products</a> | 
    <a href="../../../../www.sencha.com/services">Services</a> | 
    <a href="../../../../www.sencha.com/support">Support</a> | 
    <a href="../../../../www.sencha.com/training">Training</a> | 
    <a href="../../../../www.sencha.com/partners">Partners</a> | 
    <a href="../../../../www.sencha.com/blog">Community</a> | 
    <a href="../../../../www.sencha.com/company">Company</a> 
   </div> 
  </div> 
  <div id="menu-product-container" style="display:none;"> 
   <div id="menu-dropdown"> 
    <div class="menu-landing-products"> 
     <div id="menu-vertical"> 
      <p class="menu-landing-product" rel="extjs"> <a> Sencha Ext JS </a> </p> 
      <p class="menu-landing-product" rel="cmd"> <a> Sencha Cmd </a> </p> 
      <p class="menu-landing-product" rel="sencha_test"> <a> Sencha Test </a> </p> 
      <p class="menu-landing-product" rel="ide_plugins"> <a> Sencha IDE Plugins </a> </p> 
      <p class="menu-landing-product" rel="sencha_inspector"> <a> Sencha Inspector </a> </p> 
      <p class="menu-landing-product" rel="gxt"> <a> Sencha GXT </a> </p> 
      <p class="menu-landing-product" rel="webappmgr"> <a> Sencha Web Application Manager </a> </p> 
      <p class="menu-landing-product" rel="architect"> <a> Sencha Architect </a> </p> 
      <p class="menu-landing-product" rel="touch"> <a> Sencha Touch </a> </p> 
     </div> 
    </div> 
    <div id="menu-product-details"> 
     <div id="extjs-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Ext JS 
      </div> 
      <div class="menu-landing-doc-heading">
        6.x 
      </div> 
      <a href="../default.htm"> 6.0.2 </a> 
      <a class="menu-landing-zip" style="padding-right:0;" href="../../../downloads/extjs-docs-6.0.2-classic.zip"> (classic) </a> 
      <a class="menu-landing-zip menu-landing-lesspad" href="../../../downloads/extjs-docs-6.0.2-modern.zip"> (modern) </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../default.htm"> 6.0.1 </a> 
      <a class="menu-landing-zip" style="padding-right:0;" href="../../../downloads/extjs-docs-6.0.1-classic.zip"> (classic) </a> 
      <a class="menu-landing-zip menu-landing-lesspad" href="../../../downloads/extjs-docs-6.0.1-modern.zip"> (modern) </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../default.htm"> 6.0.0 </a> 
      <a class="menu-landing-zip" style="padding-right:0;" href="../../../downloads/extjs-docs-6.0.0-classic.zip"> (classic) </a> 
      <a class="menu-landing-zip" style="padding-left:0;" href="../../../downloads/extjs-docs-6.0.0-modern.zip"> (modern) </a> 
      <div class="menu-landing-doc-heading">
        5.1.x 
      </div> 
      <a href="../../5.1/default.htm"> 5.1.2 </a> 
      <a class="menu-landing-zip" href="../../../downloads/extjs-docs-5.1.2.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../5.1/default.htm"> 5.1.1 </a> 
      <a class="menu-landing-zip" href="../../../downloads/extjs-docs-5.1.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../5.1/default.htm"> 5.1.0 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/ext-docs-5.1.0.zip"> (offline docs) </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        5.0.x 
      </div> 
      <a href="../../5.0/default.htm"> 5.0.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/ext-docs-5.0.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../5.0/default.htm"> 5.0.0 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/ext-docs-5.0.0.zip"> (offline docs) </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        4.2.x 
      </div> 
      <a href="../../4.2.5/default.htm"> 4.2.5 </a> 
      <a class="menu-landing-zip" href="../../../downloads/extjs-docs-4.2.5.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.4/default.htm"> 4.2.4 </a> 
      <a class="menu-landing-zip" href="../../../downloads/extjs-docs-4.2.4.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.3/default.htm"> 4.2.3 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/extjs-docs-4.2.3.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.2/default.htm"> 4.2.2 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/extjs-docs-4.2.2.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.1/default.htm"> 4.2.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/extjs-docs-4.2.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../4.2.0/default.htm"> 4.2.0 </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        4.1.x 
      </div> 
      <a href="../../4.1.3/default.htm"> 4.1.3 </a> 
      <br /> 
      <a href="../../4.1.2/default.htm"> 4.1.2 </a> 
      <br /> 
      <a href="../../4.1.1/default.htm"> 4.1.1 </a> 
      <br /> 
      <a href="../../4.1.0/default.htm"> 4.1.0 </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        4.0.x 
      </div> 
      <a href="../../4.0.7/default.htm"> 4.0.7 </a> 
      <br /> 
      <a href="../../4.0.0/default.htm"> 4.0.0 </a> 
     </div> 
     <div id="cmd-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Cmd 
      </div> 
      <div class="menu-landing-doc-heading">
        6.x 
      </div> 
      <a href="../../../cmd/6.x"> 6.x </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <div class="menu-landing-doc-heading">
        5.x 
      </div> 
      <a href="../../../cmd/5.x"> 5.x </a> 
     </div> 
     <div id="sencha_test-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Test 
      </div> 
      <a href="../../../sencha_test/index.html"> Sencha Test </a> 
      <span class="tpl-toc-img-new">★</span> 
     </div> 
     <div id="ide_plugins-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha IDE Plugins 
      </div> 
      <a href="../../../ide_plugins/jetbrains_ide_plugin.html"> JetBrains Plugin 6.x </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../../../ide_plugins/eclipse_ide_plugin.html"> Eclipse Plugin </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../../../ide_plugins/visual_studio_ide_plugin.html"> Visual Studio Plugin </a> 
      <span class="tpl-toc-img-new">★</span> 
     </div> 
     <div id="sencha_inspector-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Inspector 
      </div> 
      <a href="../../../sencha_inspector/index.html"> Sencha Inspector 6.x </a> 
      <span class="tpl-toc-img-new">★</span> 
     </div> 
     <div id="gxt-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha GXT 
      </div> 
      <!-- GXT 4.0 --> 
      <div class="menu-landing-doc-heading">
        4.0 
       <span class="tpl-toc-img-new">★</span> 
      </div> 
      <a href="../../../../examples.sencha.com/gxt/4.0.1"> 4.0 Explorer Examples </a> 
      <br /> 
      <a href="../../../../examples.sencha.com/gxt-edash/4.0.1"> 4.0 Dashboard Example </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/gxt/examples-src/gxt-edash-4.0.1.zip"> (War) </a> 
      <br /> 
      <a href="../../../gxt/4.x/default.htm"> 4.0 Guides </a> 
      <br /> 
      <a href="../../../gxt/4.x/javadoc/gxt-4.0.0"> 4.0 Javadoc </a> 
      <br /> 
      <!-- GXT 3.1.x --> 
      <div class="menu-landing-doc-heading">
        3.1 
      </div> 
      <a href="../../../../www.sencha.com/examples/default.htm"> 3.1.4 Examples </a> 
      <br /> 
      <a href="../../../gxt/3.x/default.htm"> 3.1.4 Guides </a> 
      <br /> 
      <a href="../../../gxt/3.x/javadoc"> 3.1.4 Javadoc </a> 
      <br /> 
      <!-- GXT 3.0.x --> 
      <!-- GXT 2.x --> 
      <div class="menu-landing-doc-heading">
        2.0 
      </div> 
      <a href="../../../../https@www.sencha.com/examples-2/default.htm"> 2.3.1 Examples </a> 
     </div> 
     <div id="webappmgr-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Web Application Manager 
      </div> 
      <div class="menu-landing-doc-heading">
        6.0.x 
      </div> 
      <a href="../../../webappmgr"> 6.0.0 </a> 
      <span class="tpl-toc-img-new">★</span> 
     </div> 
     <div id="architect-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Architect 
      </div> 
      <div class="menu-landing-doc-heading">
        3.x 
      </div> 
      <a href="../../../architect/3.5/default.htm"> 3.5 </a> 
      <span class="tpl-toc-img-new">★</span> 
      <br /> 
      <a href="../../../architect/3/default.htm"> 3.2 </a> 
      <a class="menu-landing-zip menu-landing-lesspad" href="../../../../cdn.sencha.com/downloads/docs/architect-docs-3.zip"> (offline docs) </a> 
     </div> 
     <div id="touch-menu-product" class="menu-specific-product"> 
      <div class="menu-landing-doc-heading">
        Sencha Touch 
      </div> 
      <div class="menu-landing-doc-heading">
        2.4.x 
      </div> 
      <a href="../../../touch/2.4/default.htm"> 2.4.2 </a> 
      <span class="tpl-toc-img-new">★</span> 
      <a class="menu-landing-zip menu-landing-lesspad" href="../../../downloads/touch-docs-2.4.2.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../../touch/2.4/default.htm"> 2.4.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.4.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../../touch/2.4/2.4.0-apidocs"> 2.4.0 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.4.0.zip"> (offline docs) </a> 
      <div class="menu-landing-doc-heading">
        2.3.x 
      </div> 
      <a href="../../../touch/2.3.1/default.htm"> 2.3.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.3.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../../touch/2.3.0/default.htm"> 2.3.0 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.3.0.zip"> (offline docs) </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        2.2.x 
      </div> 
      <a href="../../../touch/2.2.1/default.htm"> 2.2.1 </a> 
      <a class="menu-landing-zip" href="../../../../cdn.sencha.com/downloads/docs/touch-docs-2.2.1.zip"> (offline docs) </a> 
      <br /> 
      <a href="../../../touch/2.2.0/default.htm"> 2.2.0 </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        2.1.x 
      </div> 
      <a href="../../../touch/2.1.1/default.htm"> 2.1.1 </a> 
      <br /> 
      <a href="../../../touch/2.1.0/default.htm"> 2.1.0 </a> 
      <br /> 
      <div class="menu-landing-doc-heading">
        2.0.x 
      </div> 
      <a href="../../../touch/2.0.2/default.htm"> 2.0.2 </a> 
      <br /> 
      <a href="../../../touch/2.0.1/default.htm"> 2.0.1 </a> 
      <br /> 
      <a href="../../../touch/2.0.0/default.htm"> 2.0.0 </a> 
     </div> 
    </div> 
   </div> 
  </div> 
   
  <script type="text/javascript">
    adroll_adv_id = "5RM2BL5IGRFLRG5VDQ7OIE";
    adroll_pix_id = "LWO7UZXBFVESTOMYFI2LYS";
    /* OPTIONAL: provide email to improve user identification */
    /* adroll_email = "username_40example.com"; */
    (function () {
      var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "../../../../https@s.adroll.com" : "../../../../a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
        document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
      };
      if (window.addEventListener) {window.addEventListener('load', _onload, false);}
      else {window.attachEvent('onload', _onload)}
    }());
  </script> 
  <script>
    var menu = document.getElementById("tpl-toc"),
        link_obj = document.getElementById("mobile_menu_link"),
        links = menu.querySelectorAll('a');

    for(i=0; i < links.length; i++) {
      links[i].onclick = function() {
        var mq = window.matchMedia('only screen and (max-width: 768px)');

        if(mq.matches) {
          menu.style.display = 'none';
          link_obj.innerHTML = 'MENU';
        }
      }
    }

  </script> 
  <script type="text/javascript">
    </script>              <script src='../../../../munchkin.marketo.net/munchkin-beta.js' type='text/javascript'></script><script>Munchkin.init('374-WES-121');</script>   
 
</body></html>